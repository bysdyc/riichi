  <view wx:if="{{visible}}" class="overlay" bindtap="onBackground">
  <view id="dialogContent" class="dialog-card" catchtap="noop">
    <view class="dialog-header">
      <text class="dialog-title">ğŸŠ å¯¹å±€ç»“æŸ</text>
    </view>

    <scroll-view class="dialog-scroll" scroll-y="true">
      <view class="final-scores">
        <view class="section-title">æœ€ç»ˆæ’å</view>
        <view class="ranking-list">
          <block wx:for="{{rankedPlayers}}" wx:key="index">
            <view class="ranking-item rank-{{index + 1}}">
              <view class="rank-badge">
                <text class="rank-number">{{index + 1}}</text>
                <text class="rank-medal" wx:if="{{index === 0}}">ğŸ¥‡</text>
                <text class="rank-medal" wx:elif="{{index === 1}}">ğŸ¥ˆ</text>
                <text class="rank-medal" wx:elif="{{index === 2}}">ğŸ¥‰</text>
              </view>
              <view class="player-info">
                <text class="player-name">{{item.name}}</text>
              </view>
              <view class="score-info">
                <text class="final-score">{{item.score}}</text>
                <text class="score-diff {{item.scoreDiff >= 0 ? 'positive' : 'negative'}}">
                  {{item.scoreDiff >= 0 ? '+' : ''}}{{item.scoreDiff}}
                </text>
              </view>
            </view>
          </block>
        </view>
      </view>

      <view class="game-stats">
        <view class="section-title">å¯¹å±€ç»Ÿè®¡</view>
        <view class="stats-grid">
          <view class="stat-item">
            <text class="stat-label">å¯¹å±€ç±»å‹</text>
            <text class="stat-value">{{gameTypeLabel}}</text>
          </view>
          <view class="stat-item">
            <text class="stat-label">æ€»å±€æ•°</text>
            <text class="stat-value">{{roundHistory.length}} å±€</text>
          </view>
          <view class="stat-item">
            <text class="stat-label">æœ€ç»ˆåœºæ¬¡</text>
            <text class="stat-value">{{finalRoundDisplay}}</text>
          </view>
          <view class="stat-item">
            <text class="stat-label">æœ¬åœºæ•°</text>
            <text class="stat-value">{{gameState.honba || 0}} æœ¬åœº</text>
          </view>
        </view>
      </view>

      <view class="player-details">
        <view class="section-title">è¯¦ç»†æ•°æ®</view>
        <block wx:for="{{playerStats}}" wx:key="index">
          <view class="player-detail-card">
            <view class="player-detail-header">
              <text class="player-detail-name">{{item.name}}</text>
              <text class="player-detail-score">{{item.score}} ç‚¹</text>
            </view>
            <view class="detail-stats">
              <view class="detail-stat">
                <text class="detail-label">å’Œç‰Œæ¬¡æ•°</text>
                <text class="detail-value">{{item.winCount}}</text>
              </view>
              <view class="detail-stat">
                <text class="detail-label">æ”¾é“³æ¬¡æ•°</text>
                <text class="detail-value">{{item.loseCount}}</text>
              </view>
              <view class="detail-stat">
                <text class="detail-label">ç«‹ç›´æ¬¡æ•°</text>
                <text class="detail-value">{{item.riichiCount}}</text>
              </view>
            </view>
          </view>
        </block>
      </view>
    </scroll-view>

    <view class="dialog-actions">
      <button class="action-btn secondary" bindtap="onViewHistory">æŸ¥çœ‹å†å²</button>
      <button class="action-btn secondary" bindtap="onSaveImage">ä¿å­˜å›¾ç‰‡</button>
      <button class="action-btn primary" bindtap="onClose">å…³é—­</button>
    </view>
  </view>
  
  <!-- éšè—çš„ç”»å¸ƒç”¨äºç”Ÿæˆå›¾ç‰‡ -->
  <canvas type="2d" id="gameOverCanvas" style="position: fixed; left: -9999px; top: -9999px; width: 750px; height: 2000px;"></canvas>
</view>
