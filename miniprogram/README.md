# 日本麻将记录器 - 微信小程序版

这是一个用于记录日本麻将（立直麻将）游戏的微信小程序。

## 功能特点

### 🎮 游戏模式
- **东风战**：东场4局
- **半庄战**：东场+南场 8局
- **一庄战**：东南西北 16局
- **飞び规则**：支持破产终止选项

### 📊 核心功能
- 玩家分数实时追踪
- 立直状态管理
- 和牌记录（自摸/荣和）
- 流局处理（听牌判定）
- 番符点数自动计算
- 本场和立直棒管理
- 游戏历史记录

### 💾 数据持久化
- 使用微信小程序本地存储
- 自动保存游戏进度
- 支持继续未完成的游戏

## 文件结构

```
miniprogram/
├── pages/
│   ├── index/          # 首页（选择游戏类型）
│   │   ├── index.wxml
│   │   ├── index.wxss
│   │   ├── index.js
│   │   └── index.json
│   ├── game/           # 游戏主页面
│   │   ├── game.wxml
│   │   ├── game.wxss
│   │   ├── game.js
│   │   └── game.json
│   └── history/        # 历史记录页面
│       ├── history.wxml
│       ├── history.wxss
│       ├── history.js
│       └── history.json
├── utils/
│   └── mahjong.js      # 麻将计算逻辑
├── app.js              # 小程序入口
├── app.json            # 小程序配置
├── app.wxss            # 全局样式
└── sitemap.json        # 站点地图配置
```

## 使用说明

### 1. 开发环境
- 微信开发者工具
- 微信小程序开发账号

### 2. 导入项目
1. 打开微信开发者工具
2. 选择"导入项目"
3. 选择 `miniprogram` 文件夹
4. 填写 AppID（或使用测试号）

### 3. 开始游戏
1. 在首页选择游戏类型（东风战/半庄战/一庄战）
2. 可选择是否启用"飞び"规则
3. 点击开始后进入游戏页面
4. 四位玩家默认为：甲、乙、丙、丁（初始点数25000）

### 4. 游戏操作

#### 立直
- 点击玩家卡片下方的"立直"按钮
- 自动扣除1000点立直棒
- 立直棒计入当局立直棒总数

#### 和牌
1. 点击"和牌"按钮
2. 选择和牌方式：自摸/荣和
3. 选择和牌者
4. 如果是荣和，选择放铳者
5. 输入番数、符数
6. 输入宝牌数量（表宝、里宝、红宝）
7. 确认后自动计算和分配点数

#### 流局
1. 点击"流局"按钮
2. 选择听牌的玩家（可多选）
3. 确认后自动计算听牌罚符（3000点分配）

#### 查看历史
- 点击"历史"按钮查看本局所有和牌和流局记录

### 5. 点数计算规则

小程序自动计算点数，支持：
- 役满及以上（13番+）
- 累计役满（11-12番）
- 三倍满（8-10番）
- 倍满（6-7番）
- 跳满（5番）
- 满贯以下（根据番符计算）

### 6. 游戏结束条件
- 完成所有规定局数
- 有玩家破产（开启飞び规则时）

## 核心计算逻辑

### 点数计算（utils/mahjong.js）
```javascript
calculatePoints(han, fu, isDealer, isTsumo)
```
- 根据番数、符数计算基础点
- 区分庄家/闲家
- 区分自摸/荣和
- 返回点数分配方案

### 流局罚符（utils/mahjong.js）
```javascript
calculateDrawPayment(tenpaiedPlayers)
```
- 听牌者平分3000点
- 未听牌者均摊扣除

### 场况判定（utils/mahjong.js）
```javascript
checkGameEnd(gameSettings, gameState, players, currentDealerIndex)
```
- 检查是否达到游戏结束条件
- 支持飞び规则判定

## 与原HTML版本的区别

### 简化的功能
本小程序版本为了适配移动端和小程序平台，做了以下简化：
1. **手牌分析**：原版支持输入手牌自动分析役种，小程序版改为手动输入番符
2. **复杂役种**：简化了役种系统，专注于点数计算
3. **副露功能**：暂未实现副露（吃碰杠）的手牌输入
4. **多人和牌**：暂未实现三家和等特殊情况

### 保留的核心功能
1. ✅ 游戏类型选择（东风战/半庄战/一庄战）
2. ✅ 完整的点数计算系统
3. ✅ 立直状态管理
4. ✅ 流局处理
5. ✅ 本场和立直棒管理
6. ✅ 历史记录
7. ✅ 数据持久化
8. ✅ 游戏结束判定和排名

## 后续开发计划

- [ ] 玩家昵称自定义
- [ ] 详细的历史记录统计
- [ ] 役种列表选择（手动模式）
- [ ] 手牌输入和自动分析
- [ ] 多人和牌支持
- [ ] 数据导出功能
- [ ] 美化UI和动画效果

## 技术栈

- 微信小程序原生框架
- JavaScript ES6+
- WXML + WXSS

## 许可证

基于原HTML版本改编，仅供学习和个人使用。

---

**注意**：本小程序仅用于记录游戏数据，不涉及任何赌博或金钱交易。
