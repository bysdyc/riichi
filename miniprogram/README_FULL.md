# 日本麻将记录器 - 微信小程序版（完整版）

这是一个功能完整的日本麻将（立直麻将）游戏记录微信小程序，支持手牌输入、自动役种分析、多人和牌等高级功能。

## ✨ 核心特性

### 🎮 三种和牌记录模式

#### 1. 📝 手牌输入模式（完整牌型分析）
- **手牌选择**：通过可视化牌选择器输入13张手牌
- **副露管理**：支持添加顺子、碰、明杠、暗杠
- **和牌设定**：选择第14张和牌
- **状况役**：支持立直、一发、双立直、海底、河底、岭上、抢杠等
- **自动分析**：
  - 自动检测国士无双、七对子等特殊牌型
  - 自动判断所有役种（清一色、平和、对对和等）
  - 自动计算番数和符数
  - 支持复合役判定

#### 2. ✍️ 手动输入模式（快速记录）
- 直接输入番数和符数
- 适合熟悉规则的玩家快速记录
- 保留原有的简洁操作体验

#### 3. 👥 多人和牌模式（三家和/三麻）
- **支持2-3人同时和牌**
- 选择放铳者（必须）
- 为每位和牌者分别设置番数和符数
- 自动计算复杂的点数分配：
  - 放铳者支付所有点数
  - 立直棒平均分配给所有和牌者
  - 本场费平均分配
  - 如有庄家和牌则连庄
- 详细记录每位和牌者的信息

## 🀄 支持的役种（完整）

### 役满（13番+）
- 国士无双/国士无双十三面
- 四暗刻/四暗刻单骑
- 大三元
- 大四喜/小四喜
- 字一色
- 清老头
- 绿一色
- 九莲宝灯/纯正九莲宝灯
- 四杠子
- 天和/地和/人和

### 6番
- 清一色

### 3番
- 混一色
- 纯全带幺九
- 两杯口

### 2番
- 七对子、对对和、三暗刻
- 混老头、小三元
- 三色同顺、三色同刻
- 一气通贯、混全带幺九
- 双立直

### 1番
- 立直、一发、门前清自摸和
- 役牌（东南西北白发中）
- 平和、一杯口、断幺九
- 海底摸月/河底捞鱼
- 岭上开花/抢杠

## 📁 文件结构

```
miniprogram/
├── components/
│   └── tile-selector/      # 可视化牌选择器组件
├── pages/
│   ├── index/              # 首页（游戏类型选择）
│   ├── game/               # 游戏主页面
│   └── history/            # 历史记录
├── utils/
│   ├── mahjong.js          # 点数计算逻辑
│   └── yaku-analyzer.js    # 完整的役种分析引擎
├── app.js                  # 小程序入口
├── app.json                # 小程序配置
└── app.wxss                # 全局样式
```

## 🚀 快速开始

### 1. 开发环境
- 微信开发者工具
- 微信小程序开发账号

### 2. 导入项目
1. 打开微信开发者工具
2. 选择"导入项目"
3. 选择 `miniprogram` 文件夹
4. 填写 AppID（或使用测试号）

### 3. 开始使用

#### 场景1：使用手牌输入模式
1. 选择游戏类型，进入游戏页面
2. 点击"和牌"按钮
3. 切换到"手牌输入"模式
4. 点击"+选择手牌"，选择13张手牌
5. 如有副露，点击"+添加副露"
6. 点击"选择和牌"，选择第14张和牌
7. 勾选状况役（立直、一发等）
8. 点击"分析牌型"，自动识别役种
9. 选择和牌者和放铳者
10. 输入宝牌数量
11. 确认记录

#### 场景2：记录三家和
1. 点击"和牌"按钮
2. 切换到"多人和牌"模式
3. 选择放铳者
4. 勾选2-3位和牌者
5. 为每位和牌者输入番数和符数
6. 确认记录

#### 场景3：快速记录
1. 点击"和牌"按钮
2. 保持"手动输入"模式
3. 选择和牌者、输入番符
4. 确认记录

## 🎨 组件说明

### tile-selector（牌选择器）
可复用的可视化麻将牌选择组件：
- 支持万子、筒子、索子、字牌分类显示
- 自动显示已选数量
- 限制每种牌最多4张
- 支持最大张数限制

### yaku-analyzer（役种分析引擎）
完整的麻将牌型分析引擎：
- 国士无双检测
- 七对子检测
- 标准牌型（4面子+1雀头）分解
- 所有役种自动判定
- 复合役处理
- 符数自动计算

## 🔧 核心算法

### 牌型分解算法
```javascript
// 递归分解面子
findMelds(tileCounts) -> 刻子/顺子组合
findStandardCombinations(tiles) -> 4面子+1雀头
```

### 役种判定
```javascript
calculateYaku(combo, winTile, context) -> { yaku, han }
// 支持：
// - 役满判定（天和、地和、国士、四暗刻等）
// - 一般役判定（清一色、平和、对对和等）
// - 状况役（立直、海底等）
// - 复合役处理
```

### 符数计算
```javascript
calculateFu(combo, winTile, context) -> fu
// 考虑：
// - 基础符20
// - 副底（门前荣和+10，门前自摸+2）
// - 雀头符（役牌+2）
// - 面子符（刻子、杠子）
// - 听牌形式（单骑、坎张、边张+2）
```

## 🎯 与原HTML版本对比

### 完整保留 ✅
- ✅ 完整的手牌输入和役种分析
- ✅ 多人和牌（三家和）支持
- ✅ 所有役满和一般役的识别
- ✅ 副露（吃碰杠）管理
- ✅ 状况役判定
- ✅ 自动番符计算
- ✅ 游戏流程管理

### 小程序增强 🌟
- 更直观的可视化牌选择器
- 移动端优化的触控界面
- 响应式卡片布局
- 三种模式自由切换
- 本地数据持久化
- 随时随地记录对局

## 💡 技术亮点

1. **完整的麻将规则引擎**：从HTML完整移植的役种判定和符数计算
2. **可复用组件设计**：tile-selector可用于其他麻将相关小程序
3. **三种输入模式**：满足不同熟练度玩家的需求
4. **复杂点数计算**：支持多人和牌的复杂分配逻辑
5. **数据持久化**：完整的游戏状态保存和恢复

## 📝 后续开发计划

- [ ] 玩家昵称自定义
- [ ] 更详细的历史记录统计
- [ ] 数据导出功能（分享对局记录）
- [ ] UI动画效果增强
- [ ] 听牌分析功能
- [ ] 对局回放功能

## 📄 许可证

基于原HTML版本改编，仅供学习和个人使用。

---

**注意**：本小程序仅用于记录游戏数据，不涉及任何赌博或金钱交易。
