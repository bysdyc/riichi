# 日本麻将记录器 - 手动选择役种功能说明

## 🎯 新功能概述

现在您可以在"自动分析"和"手动选择役种"两种模式之间自由切换！

**手动模式的核心优势：不需要输入手牌，直接选择役种和设置符数即可快速计算点数！**

---

## 📱 使用方法

### 1. 模式切换

在和牌结算界面，选择和牌者后，您会看到**役种分析模式**选项：

```
┌─────────────────────────────────────┐
│    役种分析模式                      │
├─────────────────────────────────────┤
│  🤖 自动分析  │  ✋ 手动选择         │
└─────────────────────────────────────┘
```

- **🤖 自动分析**（默认）：需要输入13张手牌+和牌，程序自动识别所有役种
- **✋ 手动选择**：**无需输入手牌**，直接选择役种和符数，程序计算点数

---

### 2. 手动选择模式操作

#### 步骤1：基本设置
1. 选择**和牌类型**（自摸/荣和）
2. 选择**和牌者**
3. 如需要，设置**放炮者**（荣和时）
4. 设置**立直玩家**（影响立直棒计算）

#### 步骤2：切换到手动模式
点击"✋ 手动选择"按钮

#### 步骤3：选择役种
从分类列表中选择役种（可多选）：

```
已选役种 (3):
┌──────────────────────────────────┐
│ 立直 × │ 一发 × │ 平和 ×          │
└──────────────────────────────────┘

役满（13番/26番）
├─ 国士无双十三面待、国士无双
├─ 四暗刻単騎、四暗刻
└─ ...

6番
└─ 清一色

3番
├─ 混一色、纯全带幺九
└─ 两杯口

2番
├─ 七对子、对对和、三暗刻
└─ ...

1番
├─ 立直、一发、门前清自摸和
└─ ...
```

#### 步骤4：设置符数
在符数设置区选择符数：

```
┌─────────────────────────────────────┐
│ 20符 │ 25符 │ 30符 │ 40符 │ 50符 │  │
│ 60符 │ 70符 │ 80符 │ 90符 │100符 │  │
└─────────────────────────────────────┘

💡 提示: 平和自摸20符/荣和30符，七对子25符，其他一般40符起
```

#### 步骤5：设置宝牌（可选）
设置Dora、里Dora、赤Dora数量

#### 步骤6：查看结果并确认
- 程序自动验证役种冲突
- 自动计算总番数和点数
- 点击"确定"完成记录

---

## ✅ 智能冲突检测

程序会自动检测以下冲突：

### 互斥关系
- **天和、地和、人和** - 只能选一个
- **立直、双立直** - 只能选一个
- **海底捞月、河底捞鱼** - 只能选一个
- **岭上开花、抢杠** - 只能选一个
- **一杯口、两杯口** - 只能选一个
- **混全带幺九、纯全带幺九** - 只能选一个
- **混一色、清一色** - 只能选一个
- **国士无双、国士无双十三面待** - 只能选一个
- **四暗刻、四暗刻単騎** - 只能选一个
- **九莲宝灯、纯正九莲宝灯** - 只能选一个

### 逻辑冲突
- **国士无双** 不能与其他役种复合（除字一色）
- **七对子** 与对对和、一杯口/两杯口、三色同顺、一气通贯冲突
- **平和** 与对对和、七对子冲突
- **断幺九** 与含幺九牌的役种冲突（混老头、清老头、混全带幺九、纯全带幺九）
- **一发** 需要立直或双立直

### 前置条件检查
- **一发** 必须先选择"立直"或"双立直"

---

## 💡 使用场景

### 适合使用手动模式的情况：

1. **⚡ 快速记录**：您已经知道役种和符数，想要秒速记录
2. **📝 简化输入**：不想输入13张手牌，只关心最终点数
3. **🎓 学习验证**：检验自己对役种和符数计算的理解
4. **🎯 精确记录**：已经自己算好了役种和符数，直接输入
5. **📱 移动端友好**：减少输入，操作更快捷

### 适合使用自动模式的情况：

1. **🎓 学习阶段**：让程序帮您识别所有可能的役种
2. **🤔 不确定**：不确定有哪些役种或符数多少
3. **📊 听牌分析**：需要查看所有可能的和牌
4. **📝 完整记录**：需要记录完整的手牌信息作为存档

---

## 🎨 界面对比

### 自动分析模式
```
需要输入：
✓ 和牌类型（自摸/荣和）
✓ 和牌者
✓ 放炮者（荣和时）
✓ 13张手牌
✓ 1张和牌
✓ 状况役选择
✓ 宝牌数量

程序输出：
→ 自动识别所有役种
→ 自动计算符数
→ 自动计算点数
```

### 手动选择模式
```
需要输入：
✓ 和牌类型（自摸/荣和）
✓ 和牌者
✓ 放炮者（荣和时）
✓ 役种选择（多选）
✓ 符数设置
✓ 宝牌数量

程序输出：
→ 验证役种冲突
→ 自动计算点数
```

**手动模式省略了手牌输入步骤，大幅提升记录速度！**

---

## 📊 实际使用示例

### 示例1：快速记录立直平和
```
场景：玩家荣和了立直平和断幺九
传统方式：需要输入13张手牌+和牌
手动模式：
  1. 选择"荣和"
  2. 选择"和牌者"
  3. 选择"放炮者"
  4. 切换到"手动选择"
  5. 选择：立直、平和、断幺九
  6. 设置：30符（平和荣和）
  7. 设置：1个Dora
  8. 确认 → 完成！

耗时：自动模式约2分钟 vs 手动模式约20秒
```

### 示例2：役满快速记录
```
场景：玩家自摸大三元
传统方式：需要输入13张手牌+和牌
手动模式：
  1. 选择"自摸"
  2. 选择"和牌者"
  3. 切换到"手动选择"
  4. 选择：大三元
  5. 符数：40符（役满符数不影响点数）
  6. 确认 → 完成！

耗时：自动模式约2分钟 vs 手动模式约10秒
```

### 示例3：复杂役种验证
```
场景：想验证"清一色+三色同顺"是否冲突
手动模式：
  1. 选择：清一色、三色同顺
  2. 查看提示：❌ 清一色与三色同顺冲突
  
→ 立即发现冲突，帮助学习！
```

---

## 🎓 符数速查表

为方便手动模式使用，提供常见符数参考：

| 牌型 | 符数 | 说明 |
|-----|------|------|
| 平和自摸 | 20符 | 固定 |
| 平和荣和 | 30符 | 固定 |
| 七对子 | 25符 | 固定 |
| 门清荣和 | 30符 | 底符20+门清荣和10 |
| 副露荣和 | 30符 | 最低30符 |
| 副露自摸 | 30符 | 最低30符 |
| 普通门清自摸 | 30符起 | 底符20+自摸2+其他符 |
| 对对和 | 40符起 | 刻子较多 |
| 混老头/清老头 | 50符起 | 幺九牌刻子 |

💡 不确定符数时，一般选择40符较为保险

---

## 🎨 界面特色

### 已选役种显示
```
已选役种 (3):
┌──────────────────────────────────┐
│ 立直 × │ 一发 × │ 平和 ×          │
└──────────────────────────────────┘
```

### 冲突提示
```
⚠️ 役种冲突: 平和与对对和冲突
```

### 番数自动计算
- 自动根据门前/副露状态调整番数
- 自动加上宝牌番数
- 立直时自动加里宝

---

## 📊 番数计算规则

### 门前/副露调整
某些役种在副露时番数会降低：

| 役种 | 门前 | 副露 |
|-----|------|------|
| 清一色 | 6番 | 5番 |
| 混一色 | 3番 | 2番 |
| 纯全带幺九 | 3番 | 2番 |
| 三色同顺 | 2番 | 1番 |
| 一气通贯 | 2番 | 1番 |
| 混全带幺九 | 2番 | 1番 |

### 宝牌加算
- **Dora**: 无限制
- **里Dora**: 仅立直/双立直时有效
- **赤Dora**: 无限制

### 符数处理
手动模式下符数使用默认值：
- **平和**: 自摸20符，荣和30符
- **七对子**: 固定25符
- **其他**: 固定40符

> 💡 提示：如需精确符数，建议使用自动分析模式

---

## 🔧 技术实现

### 核心功能
1. ✅ 完整的役种数据库（42个役种）
2. ✅ 智能冲突检测系统
3. ✅ 番数自动计算
4. ✅ 实时错误提示
5. ✅ 门前/副露自适应

### 数据结构
```javascript
{
  id: 'riichi',           // 役种ID
  name: '立直',           // 显示名称
  han: 1,                 // 门前番数
  hanNaki: undefined,     // 副露番数（可选）
  category: '1han'        // 分类
}
```

---

## 🎉 优势总结

| 特性 | 自动分析 | 手动选择 |
|-----|---------|---------|
| 输入手牌 | ✅ 需要13张 | ❌ 不需要 |
| 速度 | 较慢（2分钟） | ⚡ 极快（10-20秒） |
| 准确性 | 🎯 程序精确 | 取决于用户 |
| 学习价值 | ✅ 学习役种判断 | ✅ 学习役种组合 |
| 冲突检测 | 自动 | ✅ 实时验证 |
| 符数计算 | 自动精确 | 手动设置 |
| 适用场景 | 学习/完整记录 | 🌟 快速记录/验证 |
| 移动端友好 | 一般 | 🌟 非常友好 |

**核心优势：手动模式无需输入手牌，记录速度提升10倍！**

---

## 📝 使用建议

### 新手推荐流程
1. **学习阶段**：使用自动分析模式，输入手牌学习役种识别
2. **熟练阶段**：逐渐过渡到手动模式，加快记录速度
3. **对比验证**：两种模式交叉使用，验证自己的理解

### 老手推荐流程
1. **日常对局**：手动模式快速记录
2. **复杂牌型**：自动模式确认役种
3. **教学演示**：手动模式快速展示各种役种组合

### 最佳实践
- ✅ 简单役种用手动模式（立直、平和、对对和等）
- ✅ 复杂役种用自动模式验证
- ✅ 役满直接用手动模式（速度最快）
- ✅ 不确定符数时选40符
- ✅ 利用冲突检测学习役种关系

---

## 🚀 未来改进方向

- [ ] 手动模式支持常用役种组合快捷选择
- [ ] 提供役种推荐（根据已选役种智能推荐可能的复合役）
- [ ] 支持保存常用役种组合模板
- [ ] 添加符数计算辅助工具
- [ ] 支持历史记录快速复用

---

**享受更快速、更灵活的日本麻将记录体验！** 🎊

## 🔑 快捷键参考（规划中）

| 功能 | 快捷键 | 说明 |
|-----|--------|------|
| 切换模式 | M | 在自动/手动模式间切换 |
| 确认 | Enter | 确认和牌结算 |
| 取消 | Esc | 取消当前操作 |

**享受更灵活的日本麻将记录体验！** 🎊
