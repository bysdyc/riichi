# 听牌分析位置调整说明

## 修改日期
2025年10月31日

## 需求描述
将听牌分析功能移动到麻将牌选择器上面，默认不显示，只有当用户选择满手牌（13张）后才出现，并提供折叠按钮。

## 实现内容

### 1. 数据结构调整 (index.js)
在 `Page.data` 中添加了新的状态变量：
- `singleWinTenpaiExpanded: true` - 控制听牌分析区域的展开/收起状态，默认展开

### 2. 界面布局调整 (index.wxml)
- **移动位置**：将听牌分析区域从原来的位置（宝牌计数下方）移动到麻将牌选择器上方
- **条件显示**：添加条件 `wx:if="{{singleWinHandTiles.length === singleWinMaxHandTiles}}"` 
  - 只有当手牌数量达到最大值（13张）时才显示听牌分析区域
- **折叠功能**：
  - 在区域头部添加展开/收起按钮
  - 使用 `{{singleWinTenpaiExpanded ? '收起' : '展开'}}` 显示按钮文本
  - 听牌详情内容包裹在 `wx:if="{{singleWinTenpaiExpanded}}"` 条件中

### 3. 交互功能 (index.js)
添加了折叠切换方法：
```javascript
onToggleTenpaiPanel() {
  this.setData({ singleWinTenpaiExpanded: !this.data.singleWinTenpaiExpanded });
}
```

### 4. 状态重置
在以下场景重置 `singleWinTenpaiExpanded` 为 `true`：
- 打开单人和牌面板时
- 切换分析模式时
- 确认结算后

### 5. 样式优化 (index.wxss)
添加了专门的样式类：
- `.tenpai-analysis-section` - 听牌分析区域整体样式
  - 黄色主题背景 (#fef9c3)
  - 金色边框 (#facc15)
  - 带有轻微阴影效果
  - 下方留出间距
  
- `.section-actions` - 区域头部操作按钮容器
  - 横向布局，不换行
  - 包含提示文本和折叠按钮
  
- `.toggle-btn` - 折叠按钮样式
  - 小型按钮，紧凑布局
  - 白色背景，金色边框
  - 棕色文字
  - 点击时有背景变化效果

## 用户体验提升

1. **智能显示**：听牌分析不会在手牌不完整时显示，避免干扰用户
2. **位置优化**：放在麻将牌选择器上方，用户录入完手牌后立即可以看到分析结果
3. **视觉醒目**：使用黄色主题，与其他区域区分开来，易于识别
4. **灵活折叠**：用户可以根据需要收起听牌分析，节省屏幕空间
5. **状态保持**：在同一次录入过程中，折叠状态会保持，方便用户反复查看

## 技术要点

- 条件渲染：使用 `wx:if` 实现满手牌才显示的逻辑
- 状态管理：通过 `singleWinTenpaiExpanded` 控制折叠状态
- 样式隔离：使用 `!important` 确保特殊样式不被覆盖
- 一致性：在所有重置场景都重置展开状态，保证一致的用户体验
