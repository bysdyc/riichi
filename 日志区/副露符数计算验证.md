# 副露符数计算验证文档

## 📐 符数计算公式

### 基础符数
```
底符：20符
门清荣和：+10符（有明副露时不加）
自摸：+2符
```

### 雀头（对子）符数
```
役牌（自风/场风/三元牌）：+2符
三元牌（白发中）：+2符（非役牌时）
```

### 面子符数

#### 顺子（吃）
```
无论明暗：0符
```

#### 刻子（碰/暗刻）
| 类型 | 中张牌 | 老头牌/字牌 |
|------|--------|------------|
| 明刻（碰） | 2符 | 4符 |
| 暗刻 | 4符 | 8符 |

**说明**：
- 明刻：通过碰获得的刻子
- 暗刻：自己摸到的刻子（包括荣和时未被点炮的刻子）
- 老头牌：1/9的数牌 + 所有字牌

#### 杠子
| 类型 | 中张牌 | 老头牌/字牌 |
|------|--------|------------|
| 明杠 | 8符 | 16符 |
| 暗杠 | 16符 | 32符 |
| 加杠 | 8符 | 16符 |

**说明**：
- 明杠：公开杠牌（破坏门清）
- 暗杠：暗中杠牌（不破坏门清）
- 加杠：在已碰的基础上加杠（视为明杠）

### 待牌形符数
```
单骑待牌（对子待）：+2符
边张待牌（12待3、78待9）：+2符
嵌张待牌（13待2、24待3等）：+2符
```

### 特殊规则
```
1. 符数向上取整到10的倍数
2. 平和荣和固定30符，平和自摸固定20符
3. 七对子固定25符
4. 荣和最少30符（除平和外）
5. 自摸最少20符
```

## 🧮 实例计算

### 实例1：基础碰（明刻）

**牌型**：
- 手牌：1万 2万 3万 | 4万 5万 6万 | 东东（7张）
- 副露：碰 中中中
- 和牌：7万（荣和）

**符数计算**：
```
底符：20符
碰（中中中，字牌明刻）：+4符
雀头（东东）：+2符（假设东是役牌）
合计：26符
进位：30符
```

---

### 实例2：明杠（老头牌）

**牌型**：
- 手牌：2万 3万 4万 | 5万 6万 7万 | 白白（7张）
- 副露：明杠 1万1万1万1万
- 和牌：8万（荣和）

**符数计算**：
```
底符：20符
明杠（1万1万1万1万，老头牌明杠）：+16符
雀头（白白，三元牌）：+2符
合计：38符
进位：40符
```

---

### 实例3：暗杠（保持门清）

**牌型**：
- 手牌：1万 2万 3万 | 4万 5万 6万 | 5饼5饼（7张）
- 副露：暗杠 发发发发
- 和牌：7万（荣和）

**符数计算**：
```
底符：20符
暗杠（发发发发，字牌暗杠）：+32符
门清荣和：+10符（暗杠不破坏门清）
合计：62符
进位：70符
```

**重点**：暗杠不破坏门清，所以可以加门清荣和的10符！

---

### 实例4：吃（顺子不加符）

**牌型**：
- 手牌：白 白 白 | 中 中 中 | 东东（7张）
- 副露：吃 4饼5饼6饼
- 和牌：白（荣和）

**符数计算**：
```
底符：20符
吃（4饼5饼6饼，顺子）：+0符
刻子（白白白，字牌明刻，因为副露手牌视为明刻）：...
刻子（中中中，字牌明刻）：...
```

**注意**：吃本身不加符，但导致不是门清，所以无门清荣和10符。

---

### 实例5：多个副露

**牌型**：
- 手牌：1万 2万 3万 | 东东（5张）
- 副露1：吃 4饼5饼6饼
- 副露2：碰 9索9索9索
- 和牌：东（自摸）

**符数计算**：
```
底符：20符
吃（4饼5饼6饼）：+0符
碰（9索9索9索，老头牌明刻）：+4符
刻子（东东东，字牌暗刻，因自摸）：+8符
自摸：+2符
合计：34符
进位：40符
```

**分析**：
- 吃不加符
- 明碰老头牌+4符
- 自摸时，未点炮的刻子仍算暗刻+8符
- 总共34符，进位到40符

---

### 实例6：暗杠+明碰组合

**牌型**：
- 手牌：1万 2万 3万 | 5饼5饼（5张）
- 副露1：暗杠 东东东东
- 副露2：碰 中中中
- 和牌：6饼（荣和）

**符数计算**：
```
底符：20符
暗杠（东东东东，字牌暗杠）：+32符
碰（中中中，字牌明刻）：+4符
门清荣和：+0符（有明碰，不是门清）
合计：56符
进位：60符
```

**重点**：虽然有暗杠，但因为有明碰，所以整体不是门清！

---

### 实例7：边张+暗刻

**牌型**：
- 手牌：1万 2万 3万 | 白 白 白 | 7万 8万（7张）
- 副露：吃 4饼5饼6饼
- 和牌：9万（荣和，边张）

**符数计算**：
```
底符：20符
吃（4饼5饼6饼）：+0符
刻子（白白白，因有副露，算明刻）：+4符（字牌明刻）
雀头（？）：需要根据实际牌型
边张待牌（7万8万待9万）：+2符
合计：26+符
进位：30符
```

---

### 实例8：单骑+杠

**牌型**：
- 手牌：1万 2万 3万 | 4万 5万 6万 | 东（6张）
- 副露：明杠 9索9索9索9索
- 和牌：东（荣和，单骑）

**符数计算**：
```
底符：20符
明杠（9索9索9索9索，老头牌明杠）：+16符
雀头（东东，单骑待牌）：+2符
单骑待牌：+2符
合计：40符
```

**注意**：单骑待牌既算役牌雀头+2，也算单骑+2，共+4符。

---

### 实例9：嵌张+暗杠

**牌型**：
- 手牌：1万 3万 | 4万 5万 6万 | 白白（6张）
- 副露：暗杠 中中中中
- 和牌：2万（荣和，嵌张）

**符数计算**：
```
底符：20符
暗杠（中中中中，字牌暗杠）：+32符
雀头（白白，三元牌）：+2符
嵌张待牌（1万3万待2万）：+2符
门清荣和：+10符（暗杠不破坏门清）
合计：66符
进位：70符
```

---

### 实例10：三个明副露

**牌型**：
- 手牌：东东（2张）
- 副露1：碰 1万1万1万
- 副露2：碰 9饼9饼9饼
- 副露3：碰 中中中
- 和牌：东（自摸）

**符数计算**：
```
底符：20符
碰（1万1万1万，老头牌明刻）：+4符
碰（9饼9饼9饼，老头牌明刻）：+4符
碰（中中中，字牌明刻）：+4符
刻子（东东东，自摸时算暗刻）：+8符
自摸：+2符
合计：42符
进位：50符
```

**注意**：即使有多个明副露，自摸时和牌张形成的刻子仍算暗刻！

---

## 🔍 关键验证点

### 1. 明暗区分
✅ **正确理解**：
- 通过碰/明杠获得的面子 = 明刻/明杠
- 自己摸到的面子 = 暗刻/暗杠
- 自摸时，和牌张形成的刻子 = 暗刻（即使有其他明副露）

### 2. 老头牌判定
✅ **老头牌包括**：
- 数牌的1和9：1万、9万、1饼、9饼、1索、9索
- 所有字牌：东、南、西、北、白、发、中

❌ **不是老头牌**：
- 2-8的数牌：2万~8万、2饼~8饼、2索~8索

### 3. 门清状态
✅ **保持门清**：
- 没有副露
- 只有暗杠

❌ **破坏门清**：
- 吃
- 碰
- 明杠
- 加杠

### 4. 符数进位
✅ **所有符数向上取整到10的倍数**：
- 21符 → 30符
- 26符 → 30符
- 34符 → 40符
- 56符 → 60符

### 5. 特殊固定符数
- 平和自摸：20符（不进位）
- 平和荣和：30符
- 七对子：25符（不进位）

## ❗ 常见错误

### 错误1：暗杠破坏门清
❌ **错误**：有暗杠时认为不是门清，不加门清荣和10符
✅ **正确**：暗杠不破坏门清，仍可加门清荣和10符

### 错误2：自摸时明副露的刻子计算
❌ **错误**：自摸时，所有刻子都按暗刻计算
✅ **正确**：
- 通过碰获得的刻子 = 明刻（2符/4符）
- 自己摸到的刻子（含和牌张）= 暗刻（4符/8符）

### 错误3：加杠符数
❌ **错误**：加杠按暗杠计算（16符/32符）
✅ **正确**：加杠按明杠计算（8符/16符）

### 错误4：顺子加符
❌ **错误**：吃的顺子加2符
✅ **正确**：顺子不加符（0符）

### 错误5：重复计算待牌符
❌ **错误**：单骑待役牌时，雀头+2和单骑+2重复算，只算一次+2
✅ **正确**：雀头+2和单骑+2是独立的，应该累加（共+4符）

## 📊 符数对照表

### 刻子/杠子符数速查

| 面子 | 明/暗 | 中张牌 | 老头/字 |
|------|-------|--------|---------|
| 刻子 | 明刻 | 2符 | 4符 |
| 刻子 | 暗刻 | 4符 | 8符 |
| 杠子 | 明杠 | 8符 | 16符 |
| 杠子 | 暗杠 | 16符 | 32符 |
| 杠子 | 加杠 | 8符 | 16符 |
| 顺子 | - | 0符 | 0符 |

### 常见符数组合

| 符数 | 典型情况 |
|------|---------|
| 20符 | 平和自摸 |
| 25符 | 七对子 |
| 30符 | 平和荣和 / 基础荣和 |
| 40符 | 含一个明刻 |
| 50符 | 含一个暗刻 |
| 60符 | 含一个明杠 |
| 70符 | 含一个暗杠 |
| 80符 | 多个刻子/杠 |

## ✅ 验证检查清单

符数计算时请检查：
- [ ] 底符20符已计入
- [ ] 门清荣和10符（仅门清荣和时）
- [ ] 自摸2符（仅自摸时）
- [ ] 雀头符数（役牌/三元牌）
- [ ] 每个刻子的符数（明/暗，中张/老头）
- [ ] 每个杠子的符数（明/暗/加，中张/老头）
- [ ] 顺子不加符
- [ ] 待牌形符数（单骑/边张/嵌张）
- [ ] 符数已向上取整到10的倍数
- [ ] 特殊牌型固定符数（平和/七对）

---

**文档版本**：v1.0
**适用版本**：麻将记录器 v4.1
**更新日期**：2025-10-28
