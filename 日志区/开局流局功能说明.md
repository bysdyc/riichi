# 开局流局功能说明 📢

## 功能概述

在日本麻将中,**开局流局**是一种特殊的流局情况,有别于普通的荒牌流局。

---

## 📚 规则说明

### 普通流局 (Normal Draw)
- **条件**: 牌山抽完,至少有一名玩家听牌
- **点数变化**: 听牌者从未听牌者获得3000点均分
  - 1人听牌: +3000点 (其他3人各-1000点)
  - 2人听牌: 各+1500点 (其他2人各-1500点)
  - 3人听牌: 各+1000点 (1人-3000点)
  - 4人听牌: 点数不变
  - 0人听牌: 点数不变
- **局数**: 庄家听牌→连庄,庄家未听牌→下庄
- **本场数**: +1

### 开局流局 (Starting Hand Draw) ⭐ 新功能
- **条件**: 
  - 无人鸣牌(吃/碰/杠)
  - 无人和牌
  - 牌山抽完(或四风连打等特殊情况)
- **点数变化**: **所有玩家点数不变** ✅
- **局数**: **庄家连庄** (保持当前局)
- **本场数**: +1
- **立直棒**: 立直玩家仍需交出1000点立直棒到场上

---

## 🎯 使用场景

### 场景1: 开局无人鸣牌的荒牌
```
情况: 4名玩家都没有鸣牌,牌山抽完
操作: 选择"开局流局"
结果: 
- 东1局 0本场 → 东1局 1本场 (连庄)
- 所有玩家点数不变
- 场上立直棒+1 (如有玩家立直)
```

### 场景2: 四风连打
```
情况: 第一巡,四家都打出同一风牌
操作: 选择"开局流局"
结果: 
- 东1局 0本场 → 东1局 1本场 (连庄)
- 所有玩家点数不变
```

### 场景3: 四家立直
```
情况: 四家都立直,牌山抽完
操作: 选择"开局流局"
结果: 
- 东1局 0本场 → 东1局 1本场 (连庄)
- 所有玩家点数不变
- 场上立直棒+4 (4000点)
```

### 场景4: 普通荒牌 (非开局)
```
情况: 有人鸣过牌,牌山抽完,2人听牌
操作: 选择"普通流局",勾选2名听牌玩家
结果: 
- 听牌者各+1500点
- 未听牌者各-1500点
- 庄家听牌→连庄,否则下庄
```

---

## 🖥️ 界面操作

### 步骤1: 点击流局按钮
在主界面点击 **"流局"** 按钮

### 步骤2: 选择流局类型
在弹出的流局处理对话框中:

#### 选项A: 普通流局 (默认)
```
[普通流局] [开局流局]
   ✓
```
- 显示听牌玩家选择界面
- 显示立直玩家选择界面
- 计算听牌罚符(3000点均分)

#### 选项B: 开局流局
```
[普通流局] [开局流局]
              ✓
```
- **隐藏**听牌玩家选择界面
- **隐藏**立直玩家选择界面
- 显示开局流局说明提示框:
  ```
  📢 开局流局说明：
  • 无人鸣牌，无人和牌的开局荒牌
  • 所有玩家点数不变
  • 庄家连庄，本场数+1
  • 立直玩家仍需交1000点立直棒
  ```

### 步骤3: 确认流局
点击 **"确认流局"** 按钮

---

## 📊 点数计算示例

### 示例1: 开局流局,无人立直
**场况:**
- 东1局 0本场
- 4名玩家: 东25000, 南25000, 西25000, 北25000
- 场上立直棒: 0

**操作:**
选择"开局流局" → 确认

**结果:**
- 东1局 **1本场** (连庄)
- 东25000, 南25000, 西25000, 北25000 (点数不变)
- 场上立直棒: 0

---

### 示例2: 开局流局,东家立直
**场况:**
- 东1局 0本场
- 4名玩家: 东24000(立直), 南25000, 西25000, 北25000
- 场上立直棒: 1

**操作:**
选择"开局流局" → 确认

**结果:**
- 东1局 **1本场** (连庄)
- 东24000, 南25000, 西25000, 北25000 (点数不变,立直棒已在之前扣除)
- 场上立直棒: 1 (保持)

---

### 示例3: 普通流局,2人听牌
**场况:**
- 东1局 0本场
- 4名玩家: 东25000, 南25000, 西25000, 北25000
- 有人鸣过牌
- 听牌: 东家、南家

**操作:**
选择"普通流局" → 勾选东家、南家听牌 → 确认

**结果:**
- 东1局 **1本场** (东家听牌,连庄)
- 东**26500**, 南**26500**, 西**23500**, 北**23500**
- 计算: 听牌者各+1500, 未听牌者各-1500

---

### 示例4: 普通流局,0人听牌
**场况:**
- 东1局 0本场
- 4名玩家: 东25000, 南25000, 西25000, 北25000
- 所有人都未听牌

**操作:**
选择"普通流局" → 不勾选任何玩家 → 确认

**结果:**
- 东2局 **1本场** (东家未听牌,下庄)
- 东25000, 南25000, 西25000, 北25000 (点数不变)
- 庄家变为南家

---

## 🔍 两种流局的对比

| 特性 | 普通流局 | 开局流局 |
|------|---------|---------|
| **触发条件** | 牌山抽完 | 无人鸣牌 + 牌山抽完 |
| **点数变化** | 有(3000点均分) | **无** ✅ |
| **需要选择听牌玩家** | 是 | **否** ✅ |
| **连庄规则** | 庄家听牌→连庄 | **必定连庄** ✅ |
| **本场数** | +1 | +1 |
| **立直棒处理** | 扣1000点到场上 | 扣1000点到场上 |
| **历史记录** | "流局 (X人听牌)" | **"流局 (开局流局)"** ✅ |

---

## 💡 注意事项

### ⚠️ 开局流局的判定
开局流局需要同时满足:
1. ✅ 无人吃牌
2. ✅ 无人碰牌
3. ✅ 无人杠牌
4. ✅ 无人和牌
5. ✅ 牌山抽完(或特殊流局)

如果有**任何鸣牌**行为,即使最后荒牌,也应选择**普通流局**!

### 💡 立直棒的处理
- 开局流局时,如果有玩家在之前的局中已经立直,立直棒保留在场上
- 如果有玩家在本局立直(极少见),仍需扣除1000点立直棒
- 立直棒会在下一局有人和牌时被收取

### 🎮 实战建议
1. **确认是否开局**: 回忆本局是否有人鸣过牌
2. **选择正确类型**: 无鸣牌→开局流局,有鸣牌→普通流局
3. **验证点数**: 开局流局后所有玩家点数应不变(除立直棒)

---

## 📝 历史记录显示

### 普通流局记录
```
东1局 0本场 | 东家 | 流局 (2人听牌)
役种: 东家, 南家 听牌
点数变动: +1500 / +1500 / -1500 / -1500
```

### 开局流局记录
```
东1局 0本场 | 东家 | 流局 (开局流局)
役种: 开局流局（点数不变）
点数变动: 0 / 0 / 0 / 0
```

---

## 🐛 已知限制

1. **无自动判断**: 系统不会自动判断是否是开局,需手动选择
2. **需人工确认**: 用户需自己记忆本局是否有鸣牌
3. **特殊流局**: 四风连打、四杠散了等特殊流局需手动选择开局流局

---

## ✨ 更新日志

**版本**: v1.4  
**日期**: 2025年10月28日  
**新增功能**:
- ✅ 添加"开局流局"选项
- ✅ 开局流局时点数不变
- ✅ 开局流局必定连庄
- ✅ 流局类型切换按钮
- ✅ 开局流局说明提示框
- ✅ 历史记录区分显示

---

## 🎓 规则参考

**日本麻将规则**:
- 开局流局(流し満貫/配牌流局): 无人鸣牌的荒牌,点数不变,连庄
- 普通流局(荒牌): 有鸣牌的荒牌,计算听牌罚符

**应用场景**:
- 竞技麻将规则
- 天凤/雀魂等网络麻将
- 实战麻将记录

---

## 📞 使用建议

如果不确定是否是开局流局:
1. 优先选择**普通流局**(更常见)
2. 回忆本局是否有人鸣牌
3. 参考网络麻将的流局判定

开局流局较为罕见,大部分情况应选择普通流局!
