# 状况役折叠与宝牌图标优化说明

## 修改时间
2025年10月29日

## 改进内容

### 1. 状况役默认折叠显示

#### 问题描述
之前状况役（立直、一发、天和等）始终展开显示所有按钮，占用大量屏幕空间，但实际使用中大部分情况下只会使用1-2个状况役。

#### 解决方案
实现了状况役的折叠/展开功能：

**折叠状态（默认）：**
- 只显示一个可点击的标题栏
- 标题栏显示当前激活的状况役名称
- 例如："▶️ 状况役 (门清、立直、一发)"
- 点击可展开查看所有选项

**展开状态：**
- 显示所有11个状况役按钮
- 标题栏变为："🔽 状况役 (门清、立直、一发)"
- 点击可收起

#### 代码实现

1. **添加状态变量：**
```javascript
let isYakuExpanded = false; // 默认折叠
```

2. **折叠标题栏设计：**
```html
<button
  data-action="toggle-yaku-section"
  class="w-full flex justify-between items-center py-2 px-3 rounded-lg font-bold transition-all bg-gradient-to-r from-purple-50 to-blue-50 border-2 border-purple-200 hover:border-purple-300"
>
  <span class="text-sm font-bold text-purple-800">
    ${isYakuExpanded ? '🔽' : '▶️'} 状况役
    ${(() => {
      const activeYaku = [];
      if (isMenzen) activeYaku.push('门清');
      if (isRiichi) activeYaku.push('立直');
      if (isDoubleRiichi) activeYaku.push('二立直');
      // ... 其他状况役
      return activeYaku.length > 0 ? ` (${activeYaku.join('、')})` : '';
    })()}
  </span>
  <span class="text-xs text-purple-600">${isYakuExpanded ? '收起' : '展开'}</span>
</button>
```

3. **条件渲染按钮：**
```javascript
${isYakuExpanded ? `
  <div class="grid grid-cols-3 gap-2 mt-3">
    <!-- 所有状况役按钮 -->
  </div>
` : ''}
```

4. **事件处理：**
```javascript
document.querySelector('[data-action="toggle-yaku-section"]')?.addEventListener('click', () => {
  isYakuExpanded = !isYakuExpanded;
  render();
});
```

#### 视觉设计

**标题栏样式：**
- 渐变背景：紫色到蓝色
- 边框：紫色，悬停时加深
- 图标：▶️（折叠）/ 🔽（展开）
- 动态显示已选中的状况役名称

**激活状况役显示：**
- 自动收集所有激活的状况役
- 用顿号（、）分隔显示
- 示例："(门清、立直、一发)"
- 如果没有激活的，不显示括号

#### 用户体验提升
- ✅ **节省屏幕空间**：折叠时只占1行，展开时才显示所有按钮
- 👀 **一目了然**：折叠时也能看到已选择的状况役
- 🎯 **按需展开**：只有需要修改时才展开
- 📱 **移动友好**：在小屏幕上特别有用

---

### 2. 宝牌计数器图标优化

#### 问题描述
之前的宝牌计数器使用了简单的加减图标，视觉效果平淡，不够直观和美观。

#### 解决方案
重新设计宝牌计数器，使用自定义SVG图标和渐变配色方案。

#### 视觉设计

**整体布局：**
```html
<div class="bg-white rounded-lg border-2 border-gray-200 p-3">
  <div class="text-xs text-gray-600 mb-2 font-bold text-center">
    <!-- 标签（Dora / 里Dora / 赤Dora） -->
  </div>
  <div class="flex items-center justify-center gap-2">
    <!-- 减号按钮 -->
    <!-- 数字显示 -->
    <!-- 加号按钮 -->
  </div>
</div>
```

**减号按钮：**
- 渐变背景：红色系（from-red-100 to-red-200）
- 悬停效果：加深渐变（from-red-200 to-red-300）
- 图标：粗红色横线（减号）
- 阴影：悬停时增强
- 点击效果：轻微缩小（active:scale-95）

**加号按钮：**
- 渐变背景：绿色系（from-green-100 to-green-200）
- 悬停效果：加深渐变（from-green-200 to-green-300）
- 图标：粗绿色十字（加号）
- 阴影：悬停时增强
- 点击效果：轻微缩小（active:scale-95）

**数字显示：**
- 字号：2xl（更大更醒目）
- 颜色：蓝色（text-blue-700）
- 宽度：固定12单位（避免跳动）
- 居中显示
- 粗体

**SVG图标设计：**
```html
<!-- 减号图标 -->
<svg class="w-5 h-5 text-red-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M20 12H4"/>
</svg>

<!-- 加号图标 -->
<svg class="w-5 h-5 text-green-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M12 4v16m8-8H4"/>
</svg>
```

#### 代码对比

**之前：**
```html
<div>
  <div class="text-xs text-gray-600 mb-1">{label}</div>
  <div class="flex items-center gap-2">
    <button class="p-1 bg-gray-200 rounded hover:bg-gray-300">
      <i data-lucide="minus" class="w-4 h-4"></i>
    </button>
    <span class="text-xl font-bold w-8 text-center">{value}</span>
    <button class="p-1 bg-gray-200 rounded hover:bg-gray-300">
      <i data-lucide="plus" class="w-4 h-4"></i>
    </button>
  </div>
</div>
```

**现在：**
```html
<div class="bg-white rounded-lg border-2 border-gray-200 p-3">
  <div class="text-xs text-gray-600 mb-2 font-bold text-center">{label}</div>
  <div class="flex items-center justify-center gap-2">
    <button class="p-2 bg-gradient-to-br from-red-100 to-red-200 rounded-lg hover:from-red-200 hover:to-red-300 transition-all shadow-sm hover:shadow-md active:scale-95">
      <svg class="w-5 h-5 text-red-700">...</svg>
    </button>
    <span class="text-2xl font-bold w-12 text-center text-blue-700">{value}</span>
    <button class="p-2 bg-gradient-to-br from-green-100 to-green-200 rounded-lg hover:from-green-200 hover:to-green-300 transition-all shadow-sm hover:shadow-md active:scale-95">
      <svg class="w-5 h-5 text-green-700">...</svg>
    </button>
  </div>
</div>
```

#### 改进细节

1. **卡片化设计：**
   - 白色背景
   - 灰色边框
   - 圆角
   - 适当内边距

2. **颜色语义化：**
   - 红色 = 减少
   - 绿色 = 增加
   - 蓝色 = 当前值

3. **交互反馈：**
   - 渐变背景增强质感
   - 悬停时颜色加深
   - 悬停时阴影增强
   - 点击时轻微缩小
   - 所有过渡效果平滑（transition-all）

4. **图标优化：**
   - 使用SVG代替图标字体（不依赖外部库）
   - 加粗线条（stroke-width="3"）更醒目
   - 圆角端点（stroke-linecap="round"）更柔和
   - 尺寸从w-4提升到w-5

5. **视觉层次：**
   - 标签：小字、居中、粗体
   - 数字：大字、蓝色、粗体
   - 按钮：渐变、阴影、动效

#### 用户体验提升
- 🎨 **更美观**：渐变配色和卡片设计更现代
- 🎯 **更直观**：红色减、绿色加，语义清晰
- 👆 **更易点击**：按钮更大（p-2），点击区域增加
- ✨ **更有趣**：丰富的交互动效
- 📱 **更友好**：SVG图标在任何分辨率都清晰

---

## 整体效果对比

### 之前
```
┌──────────────────────────────────────┐
│ 宝牌                                   │
│ Dora    [-] 0 [+]                     │
│ 里Dora  [-] 0 [+]                     │
│ 赤Dora  [-] 0 [+]                     │
└──────────────────────────────────────┘
┌──────────────────────────────────────┐
│ 状况役                                 │
│ [门清] [立直] [二立直]                 │
│ [一发] [天和] [地和]                   │
│ [人和] [海底] [河底]                   │
│ [岭上] [抢杠]                          │
└──────────────────────────────────────┘
```

### 现在
```
┌──────────────────────────────────────┐
│ 宝牌                                   │
│ ╔═══════╗ ╔═══════╗ ╔═══════╗       │
│ ║ Dora  ║ ║里Dora ║ ║赤Dora ║       │
│ ║[-] 0[+]║ ║[-] 0[+]║ ║[-] 0[+]║      │
│ ╚═══════╝ ╚═══════╝ ╚═══════╝       │
└──────────────────────────────────────┘
┌──────────────────────────────────────┐
│ ▶️ 状况役 (门清、立直) [展开]         │
└──────────────────────────────────────┘
```

（点击展开后）
```
┌──────────────────────────────────────┐
│ 🔽 状况役 (门清、立直) [收起]         │
│ [门清] [立直] [二立直]                 │
│ [一发] [天和] [地和]                   │
│ [人和] [海底] [河底]                   │
│ [岭上] [抢杠]                          │
└──────────────────────────────────────┘
```

---

## 技术细节

### 1. 状况役折叠实现
- 使用简单的布尔值 `isYakuExpanded` 控制
- 自动收集所有激活状况役生成摘要
- 条件渲染按钮区域
- 平滑过渡动画

### 2. SVG图标优化
- 不依赖外部图标库（之前用lucide-react）
- 使用内联SVG，减少HTTP请求
- 可自由定制颜色、大小、粗细
- 在任何分辨率下都清晰

### 3. CSS技术点
- `bg-gradient-to-br`：对角渐变
- `hover:from-X hover:to-Y`：悬停时改变渐变
- `transition-all`：所有属性平滑过渡
- `active:scale-95`：点击缩放效果
- `shadow-sm hover:shadow-md`：阴影增强

---

## 兼容性说明

### 完全兼容
- ✅ 所有现有功能正常工作
- ✅ 状况役逻辑完全不变
- ✅ 宝牌计数逻辑完全不变
- ✅ 不依赖任何新的外部库
- ✅ 在所有现代浏览器中正常显示

### 降级支持
- 如果浏览器不支持SVG：图标不显示，但功能正常
- 如果浏览器不支持渐变：显示纯色背景
- 如果浏览器不支持过渡：没有动画，但功能正常

---

## 用户反馈预期

### 预期正面反馈
1. "界面更简洁了，不常用的状况役可以折叠起来"
2. "状况役折叠时也能看到选了什么，很方便"
3. "宝牌的加减按钮更好看了，一看就知道是加还是减"
4. "按钮有动效，点击很有反馈感"

### 可能的改进方向
1. 可以考虑记住用户的折叠/展开偏好（localStorage）
2. 可以为其他常用功能也添加折叠功能
3. 可以统一所有按钮的视觉风格

---

## 总结

这两项改进都是UI层面的优化：
- **状况役折叠**：减少视觉干扰，提升空间利用率
- **宝牌图标**：增强视觉吸引力，改善交互体验

重点在于：
- 🎨 更美观的视觉设计
- 📐 更合理的空间布局
- 🎯 更清晰的信息层次
- ✨ 更丰富的交互反馈

所有改进都保持了代码的简洁性，没有引入复杂逻辑，只是优化了呈现方式。
