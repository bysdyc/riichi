# 古役功能说明

## 概述
古役(Klassic Yaku)是日本麻将中的一些非标准役种,主要在特定规则或地区使用。本功能允许玩家在开局前选择是否启用古役。

## 功能实现

### 1. 开局设置
- 在 landing 页面添加了"开启古役"开关
- 设置保存在 `gameSettings.useKlassicYaku` 中
- 与击飞规则并列显示

### 2. 包含的古役

#### 人和 (Renhou) - 役满
- **说明**: 闲家在第一巡内,在他人打出的牌上荣和
- **番数**: 13番(役满)
- **条件**: 
  - 必须是闲家(非庄家)
  - 必须是第一巡
  - 必须是荣和(不能自摸)
  - 不能有人鸣牌(包括自己)

#### 大车轮 (Daisharin) - 役满
- **说明**: 筒子的二到八各两张,共七对子
- **番数**: 13番(役满)
- **牌型**: 2筒2筒3筒3筒4筒4筒5筒5筒6筒6筒7筒7筒8筒8筒
- **特点**: 七对子的特殊形态

#### 大竹林 (Daichikurin) - 役满
- **说明**: 索子的二到八各两张,共七对子
- **番数**: 13番(役满)
- **牌型**: 2索2索3索3索4索4索5索5索6索6索7索7索8索8索
- **特点**: 七对子的特殊形态

#### 大数邻 (Daisuurin) - 役满
- **说明**: 万子的二到八各两张,共七对子
- **番数**: 13番(役满)
- **牌型**: 2万2万3万3万4万4万5万5万6万6万7万7万8万8万
- **特点**: 七对子的特殊形态

#### 八连庄 (Paarenchan) - 役满
- **说明**: 庄家连续八次和牌
- **番数**: 13番(役满)
- **条件**: 需要特殊规则支持,记录庄家连庄次数

#### 十三不塔 (Shiisanpuutaa) - 役满
- **说明**: 配牌时没有对子且没有搭子的特殊牌型
- **番数**: 13番(役满)
- **条件**: 
  - 只在配牌时判定
  - 没有任何对子
  - 没有任何顺子搭子或刻子搭子
  - 需要流局或特殊判定

## 使用方式

### 手动模式
1. 开局前在 landing 页面勾选"开启古役"
2. 进入游戏后,在手动模式下可以选择古役
3. 古役会出现在役满分类中

### 自动模式
- 目前仅"人和"有自动识别支持
- 其他古役因判定条件特殊,暂时只能在手动模式下使用

## 显示位置

### 1. 开局设置
- Landing 页面,击飞开关下方
- 格式: `开启古役（人和、大车轮等）`

### 2. 对局类型显示
- 导出文本: `对局类型: 东风战 (击飞规则、古役)`
- 结算界面: `东风战 (击飞、古役)`

### 3. 手动役种选择
- 役满分类中会包含古役
- 根据 gameSettings.useKlassicYaku 动态显示

## 技术实现

### 文件修改

1. **utils/constants.js**
   - 新增 `klassicYakuList` 数组
   - 从 `allYakuList` 中移除人和,放入古役列表
   - 导出 `klassicYakuList`

2. **pages/landing/index.js**
   - 新增 `useKlassicYaku` 数据字段
   - 新增 `onToggleKlassicYaku` 方法
   - `startGame` 中保存古役设置

3. **pages/landing/index.wxml**
   - 新增古役开关 UI

4. **pages/game/index.js**
   - 新增 `buildYakuGroups()` 和 `buildYakuMap()` 函数
   - 根据 `useKlassicYaku` 动态构建役种列表
   - 在 `onShow()` 中更新役种列表

5. **utils/formatter.js**
   - 更新导出文本格式,显示古役状态
   - 更新 Markdown 导出格式

6. **components/game-over-dialog/index.js**
   - 结算界面显示古役状态

## 注意事项

1. **向后兼容**: 旧存档中没有 `useKlassicYaku` 字段时,默认为 false
2. **动态更新**: 役种列表在页面显示时根据设置动态生成
3. **人和特殊性**: 人和只在开启古役时可用,未开启时不会出现在自动识别中
4. **手动优先**: 大部分古役因判定复杂,建议使用手动模式

## 后续扩展

可以添加的功能:
1. 大车轮/大竹林/大数邻的自动识别
2. 八连庄的自动计数和判定
3. 更多地方规则的古役
4. 古役的详细说明和示例图

---

**创建时间**: 2025年10月31日  
**版本**: 1.0.0
