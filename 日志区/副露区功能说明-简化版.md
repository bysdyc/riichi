# 副露区功能实现说明（简化版 v2.0）

## 📋 概述

为日本麻将记录器添加了**简化的副露区**功能，与手牌区共用牌选择器，自动识别副露类型，使符数计算更加准确。

## ✨ 核心改进：简化设计

### 设计理念
❌ **之前**：需要先选择副露类型（吃/碰/明杠/暗杠），然后选择牌  
✅ **现在**：直接选择牌，系统自动识别副露类型

### 自动识别规则

| 选择的牌 | 自动识别为 | 说明 |
|---------|-----------|------|
| 3张相同牌 | **碰** | 如：中中中 |
| 3张同花色连续数字 | **吃** | 如：1万2万3万 |
| 4张相同牌（选明杠） | **明杠** | 破坏门清 |
| 4张相同牌（选暗杠） | **暗杠** | 不破坏门清 |
| 其他组合 | **错误** | 提示错误信息 |

## 🎯 使用流程

### 添加副露的3个步骤

1. **选择牌**：在副露选择器中点击牌（最多4张）
2. **点击"添加副露"按钮**
3. **系统自动识别**：
   - 3张相同 → 碰
   - 3张连续 → 吃
   - 4张相同 → 弹窗询问明杠/暗杠

### 实例演示

#### 实例1：添加碰
```
操作：点击"中"3次 → 点击"添加副露"
结果：自动识别为"碰"，添加成功
门清：变为false
```

#### 实例2：添加吃
```
操作：点击"1万"、"2万"、"3万" → 点击"添加副露"
结果：自动识别为"吃"，添加成功
门清：变为false
```

#### 实例3：添加暗杠
```
操作：点击"发"4次 → 点击"添加副露"
弹窗：询问"明杠还是暗杠？"
选择：点击"取消"选择暗杠
结果：添加暗杠
门清：保持true ✅
```

#### 实例4：添加明杠
```
操作：点击"9万"4次 → 点击"添加副露"
弹窗：询问"明杠还是暗杠？"
选择：点击"确定"选择明杠
结果：添加明杠
门清：变为false
```

#### 实例5：错误情况
```
操作：选择"1万"、"3万"、"5万" → 点击"添加副露"
结果：错误提示
提示内容：
  "3张牌必须是：
   - 3张相同的牌（碰），或
   - 同花色连续数字（吃，如1-2-3万）"
```

## 🖼️ 界面布局

### 副露区结构

```
┌─────────────────────────────────┐
│  副露区 (2)        [清空副露]    │
├─────────────────────────────────┤
│ 橙色框 [吃] 1万 2万 3万  [删除]  │
│ 绿色框 [暗杠] 发发发发   [删除]  │
├─────────────────────────────────┤
│  副露选择 (0/4)      [清空]     │
│  ┌─────────────────────────┐   │
│  │ 点击下方牌选择副露...    │   │
│  └─────────────────────────┘   │
│  💡 3张相同=碰 | 3张连续=吃      │
│     4张相同=杠（明/暗）          │
│  ┌─────────────────────────┐   │
│  │   [添加副露]  (禁用)     │   │
│  └─────────────────────────┘   │
│  ┌─────────────────────────┐   │
│  │ 万子: 1万 2万 3万 ... 9万│   │
│  │ 饼子: 1饼 2饼 3饼 ... 9饼│   │
│  │ 索子: 1索 2索 3索 ... 9索│   │
│  │ 字牌: 东 南 西 北 白 发 中│   │
│  └─────────────────────────┘   │
└─────────────────────────────────┘
```

### UI元素说明

1. **已添加的副露**：
   - 橙色边框 = 明副露（吃/碰/明杠）
   - 绿色边框 = 暗副露（暗杠）
   
2. **副露选择器**：
   - 显示当前选择的牌
   - 最多4张
   - 点击已选牌可删除

3. **牌选择区**：
   - 与手牌区相同的界面
   - 共用设计，无需重复
   
4. **添加按钮**：
   - 少于3张时禁用
   - 3-4张时启用

## 🔧 技术实现

### 核心函数

```javascript
// 添加牌到副露选择器
addMeldTile(tile)

// 从副露选择器删除牌
removeMeldTile(index)

// 清空副露选择器
clearMeldTiles()

// 自动识别并添加副露（核心算法）
detectAndAddMeld() {
  if (3张牌) {
    if (3张相同) → 添加碰
    else if (同花色连续) → 添加吃
    else → 错误提示
  }
  
  if (4张牌) {
    if (4张相同) {
      询问明杠/暗杠
    } else {
      错误提示
    }
  }
}
```

### 数据结构

```javascript
// 副露选择器状态
let selectedMeldTiles = ['中', '中', '中']; // 当前选择的牌

// 副露数组
let melds = [
  {
    type: 'pon',           // 碰
    tiles: ['中', '中', '中'],
    isOpen: true           // 明副露
  },
  {
    type: 'ankan',         // 暗杠
    tiles: ['发','发','发','发'],
    isOpen: false          // 暗副露
  }
];
```

## 📊 符数计算

符数计算逻辑保持不变：

| 面子 | 明/暗 | 中张牌 | 老头/字 |
|------|-------|--------|---------|
| 顺子（吃） | 明 | 0符 | 0符 |
| 刻子（碰） | 明 | 2符 | 4符 |
| 刻子 | 暗 | 4符 | 8符 |
| 杠子（明杠） | 明 | 8符 | 16符 |
| 杠子（暗杠） | 暗 | 16符 | 32符 |

**重点**：
- 暗杠不破坏门清 ✅
- 符数向上取整到10的倍数

## ✅ 优势对比

### 简化前 vs 简化后

| 对比项 | 简化前 | 简化后 |
|--------|--------|--------|
| **操作步骤** | 选择类型 → 选择牌 → 确认 | 选择牌 → 添加（自动识别） |
| **界面复杂度** | 弹窗对话框 + 多个按钮 | 单一选择器 + 1个按钮 |
| **学习成本** | 需要知道副露类型 | 只需选择牌即可 |
| **错误率** | 可能选错类型 | 自动识别，零失误 |
| **用户体验** | 多步操作 | 快速便捷 |

### 核心优势

✅ **更简单**：2步完成，无需预选类型  
✅ **更快速**：共用牌选择器，减少重复  
✅ **更智能**：自动识别，零学习成本  
✅ **更准确**：系统识别，避免人为错误  

## 🐛 注意事项

1. **选择数量**：
   - 最少3张（碰/吃）
   - 最多4张（杠）
   - 少于3张无法添加

2. **杠的选择**：
   - 4张相同牌会弹窗询问
   - "确定" = 明杠（破坏门清）
   - "取消" = 暗杠（保持门清）

3. **门清状态**：
   - 吃/碰/明杠 → 破坏门清
   - 暗杠 → 不影响门清

## 📈 改进总结

### 删除的功能
- ❌ 副露类型选择按钮（吃/碰/明杠/暗杠按钮组）
- ❌ 复杂的弹窗对话框
- ❌ 多次验证流程

### 新增的功能
- ✅ 统一的副露选择器
- ✅ 自动识别算法
- ✅ 简化的添加流程

### 保留的功能
- ✅ 完整的符数计算
- ✅ 门清状态管理
- ✅ 数据持久化
- ✅ 副露显示和删除

---

**版本**：v5.0（简化版）  
**更新日期**：2025-10-28  
**状态**：✅ 已完成  
**改进**：大幅简化用户操作，提升使用体验
