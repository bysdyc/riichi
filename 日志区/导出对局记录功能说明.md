# 导出对局记录功能说明

## 功能概述
为日本麻将记录器添加了导出对局记录的功能，用户可以在历史记录界面和游戏结束界面导出完整的对局数据。

## 修改内容

### 1. 界面修改

#### 历史记录界面
- **位置**：对局历史页面右上角
- **添加**：绿色的"导出记录"按钮（带下载图标）
- **布局**：与"返回"按钮并列显示

#### 游戏结束界面
- **位置**：游戏结束页面底部
- **添加**：绿色的"导出对局记录"按钮（带下载图标）
- **布局**：与"再来一局"按钮并列显示（各占50%宽度）

### 2. 导出功能实现

#### 导出内容
导出的数据包含以下信息：

1. **基本信息**
   - 导出时间
   - 对局类型（东风战/半庄战/全庄战）
   - 击飞规则是否开启
   - 当前进度（风、局数、本场）
   - 立直棒数量
   - 对局状态（进行中/已结束）
   - 总局数

2. **玩家信息**
   - 玩家姓名
   - 风位
   - 当前分数
   - 立直状态
   - 按分数排名显示

3. **对局历史**
   - 每一局的详细记录
   - 包括：局数、庄家、类型、和牌者、放铳者、役种、番符、得点、立直棒、分数变化等

#### 导出格式
同时导出两种格式：

1. **TXT文本格式**
   - 文件名：`麻将对局记录_YYYY-MM-DDTHH-mm-ss.txt`
   - 特点：格式化的文本，方便直接阅读和打印
   - 包含表格式的排版和中文说明

2. **JSON数据格式**
   - 文件名：`麻将对局记录_YYYY-MM-DDTHH-mm-ss.json`
   - 特点：结构化的数据，方便程序读取和分析
   - 可用于数据分析、统计或导入其他系统

### 3. 用户体验

#### 操作流程
1. 用户点击"导出记录"或"导出对局记录"按钮
2. 系统自动生成TXT和JSON两个文件
3. 浏览器自动下载这两个文件
4. 弹出提示框告知用户导出成功及文件说明

#### 提示信息
```
对局记录已导出！

已生成两个文件：
- TXT文本格式（方便阅读）
- JSON数据格式（方便导入分析）
```

## 使用场景

1. **保存对局记录**：用户想要保存完整的对局数据作为纪念
2. **数据分析**：用户需要分析自己的对局数据（胜率、常用役种等）
3. **分享记录**：用户想要分享对局记录给其他玩家
4. **备份数据**：在重置游戏前备份当前对局数据
5. **比赛记录**：作为正式比赛的记录文档

## 技术实现

### 核心函数
```javascript
exportGameRecord()
```

### 功能特点
- 自动生成时间戳文件名
- 同时导出两种格式
- 中文本地化显示
- 完整的数据结构
- 友好的文本排版
- 自动下载功能

### 事件绑定
```javascript
document.querySelectorAll('[data-action="export-record"]').forEach(btn => {
  btn.addEventListener('click', () => {
    exportGameRecord();
  });
});
```

## 文件示例

### TXT格式示例
```
==========================================
      日本麻将对局记录
==========================================

导出时间: 2025/10/28 14:30:00
对局类型: 半庄战 (击飞规则)
当前进度: 東 1 局 / 0 本场
立直棒: 0
对局状态: 进行中
总局数: 5

------------------------------------------
玩家信息
------------------------------------------
🥇 1. 东家 (東): 32,000 点
🥈 2. 南家 (南): 26,000 点
🥉 3. 西家 (西): 24,000 点
   4. 北家 (北): 18,000 点

------------------------------------------
对局历史
------------------------------------------

【第 1 局】
  局数: 東1局 0本场
  庄家: 东家
  类型: 自摸
  和牌者: 东家
  役种: 立直 / 平和 (宝1+里1+赤0)
  番符: 3番30符
  得点: 2,900 点
  分数变化:
    东家: +2,900
    南家: -1,000
    西家: -1,000
    北家: -1,000

...
```

### JSON格式示例
```json
{
  "exportDate": "2025/10/28 14:30:00",
  "gameSettings": {
    "type": "hanchan",
    "tobu": true
  },
  "gameInfo": {
    "gameType": "半庄战",
    "tobuEnabled": true,
    "currentWind": "東",
    "currentRound": 1,
    "honba": 0,
    "riichiSticks": 0,
    "isGameOver": false
  },
  "players": [
    {
      "name": "东家",
      "wind": "東",
      "score": 32000,
      "isRiichi": false
    }
    // ...
  ],
  "roundHistory": [
    {
      "round": "東1局 0本场",
      "dealer": "东家",
      "winner": "东家",
      "type": "自摸",
      "yaku": "立直 / 平和 (宝1+里1+赤0)",
      "han": 3,
      "fu": 30,
      "score": 2900,
      "loser": "全员",
      "scoreChanges": [2900, -1000, -1000, -1000]
    }
    // ...
  ],
  "totalRounds": 5
}
```

## 注意事项

1. 导出功能不会影响当前游戏进度
2. 文件自动下载到浏览器默认下载目录
3. 文件名包含时间戳，避免覆盖旧文件
4. 两种格式可以满足不同需求（阅读vs分析）
5. JSON格式保留了完整的数据结构，可用于程序处理

## 后续优化建议

1. 添加导出格式选择（仅TXT、仅JSON或两者）
2. 支持导出为PDF格式
3. 添加打印功能
4. 支持导入功能（恢复之前的对局）
5. 添加数据统计分析功能（基于历史记录）
6. 支持导出为Excel格式
7. 添加分享到社交媒体的功能
