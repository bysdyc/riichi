# 日本麻将记分器 (Riichi Mahjong Scorer)

这是一个专为日本麻将（Riichi Mahjong）爱好者打造的微信小程序，旨在提供便捷、准确的对局记分、役种判定及牌谱记录功能。无论是线下通过手机快速记分，还是作为日麻规则的学习辅助，它都能满足你的需求。

## ✨ 核心特性

### 1. 灵活的对局模式
- **多种赛制**：支持 **东风战**、**半庄战** 以及 **全庄战**。
- **规则自定义**：
  - **击飞规则 (Tobu)**：可选择是否开启“分数小于 0 时结束游戏”。
  - **古役支持**：内置多种古役（如大车轮、燕返、十二落抬等），可按需开启。

### 2. 智能算分与役种判定
不再需要手动查表或记忆复杂的番符计算公式。
- **自动算分**：输入和牌牌型，程序自动计算符数（Fu）和番数（Han），并得出最终点数。
- **役种识别**：
  - 支持所有标准日麻役种（立直、平和、断幺九、国士无双等）。
  - 智能识别复合役种（如：清一色 + 平和 + 一杯口）。
  - **古役判定**：开启古役模式后，可识别“大车轮”、“大七星”、“燕返”等特殊役种。

### 3. 完整的对局记录
- **实时状态**：主界面实时显示当前局数（如：南二局 1本场）、立直棒数量及各家点数。
- **立直管理**：一键宣告立直，自动扣除 1000 点并增加立直棒。
- **流局处理**：
  - 支持普通流局（听牌/未听罚符计算）。
  - 支持 **流局满贯** 的特殊结算。
  - 自动处理立直棒的留存与归属。

### 4. 牌谱导出与分享
- **多格式导出**：支持将整场对局记录导出为 **纯文本**、**Markdown** 或 **JSON** 格式。
- **详细复盘**：导出内容包含每一局的局数、和牌者、番符、点数变动详情，方便赛后复盘或分享到社交平台。

## 📱 功能演示

### 1. 首页与开局
- **模式选择**：支持标准的 **东风战**、**半庄战**，以及更持久的 **全庄战**。
- **规则定制**：
  - **击飞模式**：开启后，若某位玩家点数跌至 0 或以下，对局立即结束。
  - **古役模式**：开启后，系统将支持“大车轮”、“五门齐”等非常规役种的判定。
- **断线重连**：小程序会自动保存当前对局进度，意外退出或重新打开时可点击“继续游戏”无缝恢复。

### 2. 对局主界面
- **信息概览**：顶部实时显示当前场风（如南场）、局数、本场数以及场供（立直棒）数量。
- **玩家管理**：
  - **昵称修改**：点击玩家昵称即可输入自定义名字。
  - **立直操作**：点击“宣告立直”按钮，系统会自动扣除 1000 点并增加场上立直棒；再次点击可撤销。
- **辅助功能**：
  - **历史回溯**：点击“历史”按钮，查看本场对局之前的所有记录流水。
  - **战报导出**：点击“导出”按钮，生成可分享的对局战报。

### 3. 和牌结算 (核心功能)
系统提供强大的和牌计算器，支持“单人和牌”与“多人和牌”。

#### 单人和牌流程：
1. **角色选择**：点击“单人和牌”，指定 **和牌者**。若是荣和，还需指定 **放铳者**；若是自摸，则无需指定。
2. **牌型录入 (自动算分模式)**：
   - **手牌录入**：使用麻将键盘点击录入立直后的手牌。
   - **副露设置**：支持添加 吃、碰、明杠、暗杠。
   - **和牌张**：指定最后一张和牌的牌。
   - **状态勾选**：勾选“立直”、“一发”、“岭上开花”、“海底捞月”等偶然役。
   - **宝牌计数**：手动调整宝牌（Dora）、里宝牌及红宝牌的数量。
3. **智能分析**：
   - 点击“分析”按钮，系统将自动识别所有役种（包括普通役、役满及古役）。
   - 自动计算总番数（Han）和符数（Fu）。
   - 自动计算最终点数（如：满贯 8000 点，跳满 12000 点等）。
4. **手动微调**：如果对自动计算结果有异议，也可以切换到“手动模式”直接输入番符。
5. **预览与确认**：底部实时显示各家点数变动，确认无误后点击“确定”应用。

#### 多人和牌 (双响/三响)：
- 支持添加多个和牌者。
- 统一设置唯一的放铳者。
- 分别为每位和牌者录入番符数据，系统自动汇总点数结算。

### 4. 流局处理
- **普通流局**：
  - 勾选 **听牌玩家**，系统自动计算不听罚符（场上共 3000 点的流动）。
  - 自动处理立直棒的留存（流局立直棒不回收，累积到下局）。
- **特殊流局**：
  - 支持 **流局满贯** 结算，选中达成流局满贯的玩家，系统按满贯点数进行支付结算。
  - 支持中途流局（如九种九牌、四风连打等），可选择不进行点数结算直接流局。

### 5. 结果导出
- **多格式支持**：
  - **纯文本**：适合微信聊天分享。
  - **Markdown**：适合论坛或博客发布，包含格式化排版。
  - **JSON**：适合开发者进行二次数据分析。
- **一键复制**：点击复制按钮即可将完整的对局战报粘贴分享。

## 🛠️ 技术栈

- **框架**：微信小程序原生开发 (WXML, WXSS, JavaScript)
- **核心逻辑**：纯 JavaScript 实现的麻将算法 (`utils/mahjongCore.js`)，不依赖大型第三方库，轻量高效。

## 📂 目录结构

```
mahjong-miniprogram/
├── components/          # 自定义组件
│   ├── tile-picker/     # 麻将牌选择器
│   ├── dora-counter/    # 宝牌计数器
│   └── ...
├── pages/
│   ├── landing/         # 首页（模式选择）
│   ├── game/            # 游戏主界面（核心逻辑）
│   ├── history/         # 历史记录页
│   └── export-preview/  # 导出预览页
├── utils/
│   ├── mahjongCore.js   # 麻将核心算法（役种判定、面子拆解）
│   ├── score.js         # 点数计算逻辑
│   └── constants.js     # 常量定义
├── app.js               # 全局逻辑
└── app.json             # 全局配置
```

## 🚀 快速开始

1. 克隆本项目到本地。
2. 下载并安装 [微信开发者工具](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)。
3. 打开微信开发者工具，选择“导入项目”，指向 `mahjong-miniprogram` 文件夹。
4. 填写你的 AppID（或使用测试号）。
5. 点击“编译”即可在模拟器中运行。

## 📝 支持的古役列表 (部分)

当在首页开启“古役”选项后，系统将支持以下役种的判定：
- **大车轮** (Daisharin): 筒子 2-8 各两张。
- **大竹林** (Daichikurin): 索子 2-8 各两张。
- **大数邻** (Daisuurin): 万子 2-8 各两张。
- **大七星** (Daichisei): 字牌七种各两张（双倍役满）。
- **燕返** (Tsubame Gaeshi): 荣和他人立直宣言牌（需满足特定听牌型）。
- **十二落抬** (Shiisuu Puuta): 四副露后单骑听牌并和牌。
- **五门齐** (Uu Menchi): 万、筒、索、风、三元各有一组（面子或雀头）。
- ...更多古役请查看源码 `utils/constants.js`。

---
*Enjoy your Riichi Mahjong!* 🀄
